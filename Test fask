local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local StarterGui = game:GetService("StarterGui")
local LocalPlayer = Players.LocalPlayer

-- 📌 Webhook Discord (Thay bằng link webhook của bạn)
local WebhookURL = "https://discord.com/api/webhooks/1353331618802044928/HWkDOTGUkOz_IWQGzdYVz-7aK75-R5yDN07Lw2PIpNkeo3Szj6Gv2N5S3sdWwGcXEDfj"

-- 📌 Hiển thị thông báo trên màn hình
local function showNotification(title, text, duration)
    StarterGui:SetCore("SendNotification", {
        Title = title;
        Text = text;
        Duration = duration;
    })
end

-- 📌 Gửi thông báo đến Discord Webhook
local function sendDiscordMessage(fruitName, fruitPosition)
    local data = {
        ["username"] = "Plow Hub | Auto Fruit",
        ["embeds"] = {{
            ["title"] = "🍏 Tìm thấy trái ác quỷ!",
            ["description"] = "**Tên Trái:** " .. fruitName .. "\n**Vị trí:** " .. tostring(fruitPosition),
            ["color"] = 16711680 -- Màu đỏ
        }}
    }

    local jsonData = HttpService:JSONEncode(data)
    HttpService:PostAsync(WebhookURL, jsonData, Enum.HttpContentType.ApplicationJson)
end

-- 📌 Lấy danh sách server chỉ ở Singapore 🇸🇬
local function getSingaporeServers()
    local url = "https://games.roblox.com/v1/games/2753915549/servers/Public?sortOrder=Asc&limit=100"
    local success, response = pcall(function() return game:HttpGet(url) end)

    if not success then
        print("❌ Lỗi lấy danh sách server:", response)
        return {}
    end

    local data = HttpService:JSONDecode(response)
    local singaporeServers = {}

    for _, server in pairs(data.data) do
        if server.region == "Singapore" and server.playing < server.maxPlayers then
            table.insert(singaporeServers, server.id)
        end
    end

    return singaporeServers
end

-- 📌 Đổi server (Siêu nhanh, chỉ đến server Singapore 🇸🇬)
local function fastTeleportToSingaporeServer()
    local servers = getSingaporeServers()
    if #servers > 0 then
        local randomServer = servers[math.random(1, #servers)]
        print("✅ Đang chuyển đến server Singapore:", randomServer)
        showNotification("Plow Hub | Auto Fruit", "Đổi server siêu nhanh...", 2)
        TeleportService:TeleportToPlaceInstance(game.PlaceId, randomServer, LocalPlayer)
    else
        print("❌ Không tìm thấy server Singapore! Đổi server khác...")
        showNotification("Plow Hub | Auto Fruit", "Không tìm thấy server! Đang đổi server...", 2)
        TeleportService:Teleport(game.PlaceId, LocalPlayer)
    end
end

-- 📌 Tìm trái ác quỷ gần nhất và gửi webhook
local function findNearestFruit()
    for _, fruit in pairs(Workspace:GetChildren()) do
        if fruit:IsA("Model") and fruit.Name:find("Fruit") and fruit:FindFirstChild("Handle") then
            local fruitPosition = fruit.Handle.Position
            showNotification("Plow Hub | Auto Fruit", "Đã tìm thấy trái " .. fruit.Name .. "!", 3)
            sendDiscordMessage(fruit.Name, fruitPosition)
            return true
        end
    end
    return false
end

-- 📌 Kiểm tra ngay lập tức nếu không có trái => Đổi server siêu nhanh
local function instantCheckAndSwitchServer()
    if not findNearestFruit() then
        print("❌ Không có trái! Đổi server ngay lập tức...")
        showNotification("Plow Hub | Auto Fruit", "Không có trái! Đổi server ngay...", 2)
        fastTeleportToSingaporeServer()
    else
        print("✅ Đã tìm thấy trái! Không cần đổi server.")
    end
end

-- 📌 Bắt đầu script
local function startScript()
    instantCheckAndSwitchServer() -- Kiểm tra ngay lập tức
end

startScript()
