local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- ğŸ“Œ Tá»± Ä‘á»™ng chá»n Háº£i Táº·c khi vÃ o game
local function autoSelectPirate()
    if ReplicatedStorage:FindFirstChild("Remotes") and ReplicatedStorage.Remotes:FindFirstChild("CommF_") then
        ReplicatedStorage.Remotes.CommF_:InvokeServer("SetTeam", "Pirates")
        print("âœ… ÄÃ£ tá»± Ä‘á»™ng chá»n Háº£i Táº·c!")
    else
        print("âŒ KhÃ´ng thá»ƒ chá»n team, cÃ³ thá»ƒ Ä‘Ã£ chá»n trÆ°á»›c Ä‘Ã³.")
    end
end

-- ğŸ“Œ Táº¯t va cháº¡m Ä‘á»ƒ cÃ³ thá»ƒ bay xuyÃªn tÆ°á»ng
local function disableCollision()
    for _, part in pairs(LocalPlayer.Character:GetDescendants()) do
        if part:IsA("BasePart") then
            part.CanCollide = false
        end
    end
end

-- ğŸ“Œ Láº¥y danh sÃ¡ch server chá»‰ á»Ÿ Singapore ğŸ‡¸ğŸ‡¬
local function getSingaporeServers()
    local url = "https://games.roblox.com/v1/games/2753915549/servers/Public?sortOrder=Asc&limit=100"
    local response = game:HttpGet(url)
    local data = HttpService:JSONDecode(response)

    local singaporeServers = {}
    for _, server in pairs(data.data) do
        if server.region == "Singapore" and server.playing < server.maxPlayers then
            table.insert(singaporeServers, server.id)
        end
    end

    return singaporeServers
end

-- ğŸ“Œ Äá»•i server (Chá»‰ Ä‘áº¿n server Singapore ğŸ‡¸ğŸ‡¬)
local function teleportToSingaporeServer()
    local servers = getSingaporeServers()
    if #servers > 0 then
        local randomServer = servers[math.random(1, #servers)]
        print("âœ… Äang chuyá»ƒn Ä‘áº¿n server Singapore:", randomServer)
        TeleportService:TeleportToPlaceInstance(game.PlaceId, randomServer, LocalPlayer)
    else
        print("âŒ KhÃ´ng tÃ¬m tháº¥y server Singapore phÃ¹ há»£p!")
    end
end

-- ğŸ“Œ TÃ¬m trÃ¡i Ã¡c quá»· gáº§n nháº¥t
local function findNearestFruit()
    local closestFruit = nil
    local closestDistance = math.huge

    for _, fruit in pairs(Workspace:GetChildren()) do
        if fruit:IsA("Model") and fruit.Name:find("Fruit") and fruit:FindFirstChild("Handle") then
            local distance = (LocalPlayer.Character.HumanoidRootPart.Position - fruit.Handle.Position).Magnitude
            if distance < closestDistance then
                closestDistance = distance
                closestFruit = fruit
            end
        end
    end
    return closestFruit
end

-- ğŸ“Œ Bay Ä‘áº¿n trÃ¡i Ã¡c quá»· nhanh hÆ¡n + xuyÃªn tÆ°á»ng
local function flyToFruit(fruit)
    if not fruit or not fruit:FindFirstChild("Handle") then return end
    local character = LocalPlayer.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then return end

    local humanoidRootPart = character.HumanoidRootPart
    disableCollision() -- KÃ­ch hoáº¡t xuyÃªn tÆ°á»ng
    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.Velocity = Vector3.new(0, 200, 0) -- Bay nhanh hÆ¡n
    bodyVelocity.MaxForce = Vector3.new(10000, 10000, 10000)
    bodyVelocity.Parent = humanoidRootPart
    wait(0.3)

    RunService.Heartbeat:Connect(function()
        if fruit and fruit:FindFirstChild("Handle") then
            humanoidRootPart.CFrame = CFrame.new(humanoidRootPart.Position, fruit.Handle.Position)
            bodyVelocity.Velocity = (fruit.Handle.Position - humanoidRootPart.Position).Unit * 150 -- TÄƒng tá»‘c bay
        end
    end)

    repeat wait() until (humanoidRootPart.Position - fruit.Handle.Position).Magnitude < 5
    bodyVelocity:Destroy()
    humanoidRootPart.CFrame = fruit.Handle.CFrame
    wait(0.5)
    firetouchinterest(humanoidRootPart, fruit.Handle, 0)
    firetouchinterest(humanoidRootPart, fruit.Handle, 1)
end

-- ğŸ“Œ Tá»± Ä‘á»™ng lÆ°u trÃ¡i vÃ o kho chÃ­nh xÃ¡c
local function storeFruit()
    wait(1)
    local backpack = LocalPlayer.Backpack:GetChildren()
    for _, item in pairs(backpack) do
        if item:IsA("Tool") and item.Name:find("Fruit") then
            if ReplicatedStorage:FindFirstChild("Remotes") and ReplicatedStorage.Remotes:FindFirstChild("CommF_") then
                ReplicatedStorage.Remotes.CommF_:InvokeServer("StoreFruit", item.Name)
                print("âœ… ÄÃ£ lÆ°u trÃ¡i cÃ¢y:", item.Name)
                return true
            else
                print("âŒ KhÃ´ng tÃ¬m tháº¥y Remote Ä‘á»ƒ lÆ°u Fruit!")
            end
        end
    end
    print("âŒ KhÃ´ng cÃ³ trÃ¡i nÃ o Ä‘á»ƒ lÆ°u!")
    return false
end

-- ğŸ“Œ Kiá»ƒm tra náº¿u khÃ´ng cÃ³ trÃ¡i nÃ o trong 5 giÃ¢y => Äá»•i server
local function checkAndSwitchServer()
    wait(5) -- Chá» 5 giÃ¢y
    local fruit = findNearestFruit()
    if not fruit then
        print("âŒ KhÃ´ng tÃ¬m tháº¥y trÃ¡i nÃ o trong 5 giÃ¢y! Äang Ä‘á»•i server...")
        teleportToSingaporeServer()
    else
        print("âœ… ÄÃ£ tÃ¬m tháº¥y trÃ¡i! Tiáº¿p tá»¥c thu tháº­p...")
    end
end

-- ğŸ“Œ Cháº¡y script
local function startScript()
    autoSelectPirate() -- Tá»± Ä‘á»™ng chá»n Háº£i Táº·c khi vÃ o game

    local fruit = findNearestFruit()
    if fruit then
        flyToFruit(fruit)
        if storeFruit() then
            teleportToSingaporeServer() -- Äá»•i server sau khi lÆ°u Fruit thÃ nh cÃ´ng
        end
    else
        print("â³ Äá»£i 5 giÃ¢y xem cÃ³ trÃ¡i nÃ o khÃ´ng...")
        checkAndSwitchServer()
    end
end

-- ğŸ“Œ Báº¯t Ä‘áº§u script
startScript()
