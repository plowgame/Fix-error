local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")
local LocalPlayer = Players.LocalPlayer

-- ğŸ“Œ Hiá»ƒn thá»‹ thÃ´ng bÃ¡o khi script báº¯t Ä‘áº§u
local function showNotification()
    StarterGui:SetCore("SendNotification", {
        Title = "Plow Hub | Auto Fruit";
        Text = "Äang khá»Ÿi Ä‘á»™ng...";
        Duration = 5; -- Hiá»ƒn thá»‹ trong 5 giÃ¢y
    })
end

-- ğŸ“Œ Tá»± Ä‘á»™ng chá»n Háº£i Táº·c khi vÃ o game
local function autoSelectPirate()
    for i = 1, 5 do
        if ReplicatedStorage:FindFirstChild("Remotes") and ReplicatedStorage.Remotes:FindFirstChild("CommF_") then
            ReplicatedStorage.Remotes.CommF_:InvokeServer("SetTeam", "Pirates")
            print("âœ… ÄÃ£ chá»n Háº£i Táº·c!")
            return
        end
        wait(1)
    end
    print("âŒ KhÃ´ng thá»ƒ chá»n Háº£i Táº·c!")
end

-- ğŸ“Œ Láº¥y danh sÃ¡ch server chá»‰ á»Ÿ Singapore ğŸ‡¸ğŸ‡¬
local function getSingaporeServers()
    local url = "https://games.roblox.com/v1/games/2753915549/servers/Public?sortOrder=Asc&limit=100"
    local success, response = pcall(function() return game:HttpGet(url) end)

    if not success then
        print("âŒ Lá»—i láº¥y danh sÃ¡ch server:", response)
        return {}
    end

    local data = HttpService:JSONDecode(response)
    local singaporeServers = {}

    for _, server in pairs(data.data) do
        if server.region == "Singapore" and server.playing < server.maxPlayers then
            table.insert(singaporeServers, server.id)
        end
    end

    return singaporeServers
end

-- ğŸ“Œ Äá»•i server (Chá»‰ Ä‘áº¿n server Singapore ğŸ‡¸ğŸ‡¬)
local function teleportToSingaporeServer()
    local servers = getSingaporeServers()
    if #servers > 0 then
        local randomServer = servers[math.random(1, #servers)]
        print("âœ… Äang chuyá»ƒn Ä‘áº¿n server Singapore:", randomServer)
        TeleportService:TeleportToPlaceInstance(game.PlaceId, randomServer, LocalPlayer)
    else
        print("âŒ KhÃ´ng tÃ¬m tháº¥y server Singapore! Thá»­ Ä‘á»•i server ngáº«u nhiÃªn...")
        TeleportService:Teleport(game.PlaceId, LocalPlayer)
    end
end

-- ğŸ“Œ Kiá»ƒm tra náº¿u khÃ´ng cÃ³ trÃ¡i nÃ o trong 5 giÃ¢y => Äá»•i server
local function checkAndSwitchServer()
    wait(5)
    local fruit = findNearestFruit()
    if not fruit then
        print("âŒ KhÃ´ng tÃ¬m tháº¥y trÃ¡i nÃ o! Äang Ä‘á»•i server...")
        teleportToSingaporeServer()
    else
        print("âœ… ÄÃ£ tÃ¬m tháº¥y trÃ¡i! Tiáº¿p tá»¥c thu tháº­p...")
    end
end

-- ğŸ“Œ Báº¯t Ä‘áº§u script
local function startScript()
    showNotification() -- Hiá»ƒn thá»‹ thÃ´ng bÃ¡o khi cháº¡y
    autoSelectPirate()
    checkAndSwitchServer()
end

startScript()
