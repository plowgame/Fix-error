local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local StarterGui = game:GetService("StarterGui")
local LocalPlayer = Players.LocalPlayer

-- ğŸ“Œ Webhook Discord (Thay báº±ng link webhook cá»§a báº¡n)
local WebhookURL = "https://discord.com/api/webhooks/1353331618802044928/HWkDOTGUkOz_IWQGzdYVz-7aK75-R5yDN07Lw2PIpNkeo3Szj6Gv2N5S3sdWwGcXEDfj"

-- ğŸ“Œ Hiá»ƒn thá»‹ thÃ´ng bÃ¡o trÃªn mÃ n hÃ¬nh
local function showNotification(title, text, duration)
    StarterGui:SetCore("SendNotification", {
        Title = title;
        Text = text;
        Duration = duration;
    })
end

-- ğŸ“Œ Gá»­i thÃ´ng bÃ¡o khi khá»Ÿi Ä‘á»™ng script
local function startupMessage()
    showNotification("ğŸ”¹ Plow Hub | Auto Fruit ğŸ”¹", "ğŸš€ Äang tÃ¬m trÃ¡i Ã¡c quá»·...", 5)
end

-- ğŸ“Œ Gá»­i thÃ´ng bÃ¡o Ä‘áº¿n Discord Webhook
local function sendDiscordMessage(fruitName, fruitPosition)
    local data = {
        ["username"] = "Plow Hub | Auto Fruit",
        ["embeds"] = {{
            ["title"] = "ğŸ TÃ¬m tháº¥y trÃ¡i Ã¡c quá»·!",
            ["description"] = "**TÃªn TrÃ¡i:** " .. fruitName .. "\n**Vá»‹ trÃ­:** " .. tostring(fruitPosition),
            ["color"] = 16711680 -- MÃ u Ä‘á»
        }}
    }

    local jsonData = HttpService:JSONEncode(data)
    HttpService:PostAsync(WebhookURL, jsonData, Enum.HttpContentType.ApplicationJson)
end

-- ğŸ“Œ Láº¥y danh sÃ¡ch server chá»‰ á»Ÿ Singapore ğŸ‡¸ğŸ‡¬
local function getSingaporeServers()
    local url = "https://games.roblox.com/v1/games/2753915549/servers/Public?sortOrder=Asc&limit=100"
    local success, response = pcall(function() return game:HttpGet(url) end)

    if not success then
        print("âŒ Lá»—i láº¥y danh sÃ¡ch server:", response)
        return {}
    end

    local data = HttpService:JSONDecode(response)
    local singaporeServers = {}

    for _, server in pairs(data.data) do
        if server.region == "Singapore" and server.playing < server.maxPlayers then
            table.insert(singaporeServers, server.id)
        end
    end

    return singaporeServers
end

-- ğŸ“Œ Äá»•i server (SiÃªu nhanh, chá»‰ Ä‘áº¿n server Singapore ğŸ‡¸ğŸ‡¬)
local function fastTeleportToSingaporeServer()
    local servers = getSingaporeServers()
    if #servers > 0 then
        local randomServer = servers[math.random(1, #servers)]
        print("âœ… Äang chuyá»ƒn Ä‘áº¿n server Singapore:", randomServer)
        showNotification("Plow Hub | Auto Fruit", "Äang Ä‘á»•i server...", 2)
        TeleportService:TeleportToPlaceInstance(game.PlaceId, randomServer, LocalPlayer)
    else
        print("âŒ KhÃ´ng tÃ¬m tháº¥y server Singapore! Äá»•i server khÃ¡c...")
        showNotification("Plow Hub | Auto Fruit", "KhÃ´ng tÃ¬m tháº¥y server! Äang Ä‘á»•i server...", 2)
        TeleportService:Teleport(game.PlaceId, LocalPlayer)
    end
end

-- ğŸ“Œ TÃ¬m trÃ¡i Ã¡c quá»· gáº§n nháº¥t
local function findNearestFruit()
    for _, fruit in pairs(Workspace:GetChildren()) do
        if fruit:IsA("Model") and fruit.Name:find("Fruit") and fruit:FindFirstChild("Handle") then
            local fruitPosition = fruit.Handle.Position
            showNotification("Plow Hub | Auto Fruit", "ÄÃ£ tÃ¬m tháº¥y trÃ¡i " .. fruit.Name .. "!", 3)
            sendDiscordMessage(fruit.Name, fruitPosition)
            return fruit
        end
    end
    return nil
end

-- ğŸ“Œ Tá»± Ä‘á»™ng lÆ°u trÃ¡i vÃ o kho
local function storeFruitInInventory(fruit)
    if fruit and fruit:FindFirstChild("Handle") then
        -- Teleport Ä‘áº¿n trÃ¡i
        LocalPlayer.Character.HumanoidRootPart.CFrame = fruit.Handle.CFrame
        wait(1) -- Äá»£i 1 giÃ¢y Ä‘á»ƒ nháº·t trÃ¡i

        -- Nháº·t trÃ¡i
        fireclickdetector(fruit.Handle:FindFirstChild("ClickDetector"))
        wait(2) -- Äá»£i 2 giÃ¢y Ä‘á»ƒ cháº¯c cháº¯n Ä‘Ã£ nháº·t

        -- Má»Ÿ kho Ä‘á»“
        local args = { [1] = "Open" }
        ReplicatedStorage.Remotes.CommF_:InvokeServer(unpack(args))
        wait(1)

        -- LÆ°u trÃ¡i vÃ o kho
        local args2 = { [1] = "StoreFruit" }
        ReplicatedStorage.Remotes.CommF_:InvokeServer(unpack(args2))
        wait(1)

        showNotification("Plow Hub | Auto Fruit", "âœ… ÄÃ£ lÆ°u trÃ¡i vÃ o kho!", 3)
    end
end

-- ğŸ“Œ Kiá»ƒm tra náº¿u cÃ³ trÃ¡i thÃ¬ lÆ°u vÃ o kho, náº¿u khÃ´ng thÃ¬ chá» 5 giÃ¢y rá»“i Ä‘á»•i server
local function checkAndStoreFruit()
    local fruit = findNearestFruit()

    if fruit then
        storeFruitInInventory(fruit)
    else
        print("âŒ KhÃ´ng cÃ³ trÃ¡i! Chá» 5 giÃ¢y trÆ°á»›c khi Ä‘á»•i server...")
        showNotification("Plow Hub | Auto Fruit", "KhÃ´ng cÃ³ trÃ¡i! Äang chá» 5 giÃ¢y...", 5)
        wait(5) -- â³ Chá» 5 giÃ¢y trÆ°á»›c khi Ä‘á»•i server
        fastTeleportToSingaporeServer()
    end
end

-- ğŸ“Œ Báº¯t Ä‘áº§u script
local function startScript()
    startupMessage() -- Hiá»ƒn thá»‹ thÃ´ng bÃ¡o khi cháº¡y script
    checkAndStoreFruit()
end

startScript()
